# 搞了个微信公众号自动留言的小工具，分享一下

这个周末终于把自动给公众号留言的脚本弄得差不多了。虽然代码写得乱七八糟，但好歹能跑通了。写篇文章记录一下折腾的过程，也给有需要的朋友避个坑。

## 为什么要做这个

我现在每天都要刷不少公众号文章，为了互动（懂的都懂），经常需要给同行的文章留言。

流程特别繁琐：打开公众号 -> 找最新文章 -> 点进去 -> 拉到底部 -> 点写留言 -> 输入内容 -> 点发送 -> 返回 -> 下一个。

大概算了一下，处理一个公众号至少得花30-40秒。要是想批量处理几十个号，那手指头都要断了。

我就想，这玩意儿能不能自动化？

## 怎么做的

我是做土木的，代码水平仅限于大学考过二级C语言。不过最近一直在用 AI 辅助写代码，感觉能行。

昨天下午开始折腾，断断续续搞到现在。

具体过程是这样的：

1、先把想法告诉 AI：我要做一个 Python 脚本，能自动控制微信，点开公众号文章留言。

2、AI 给了一堆代码，用的是 `pyautogui` 这个库，说是可以模拟鼠标键盘。

3、刚开始遇到个大坑。我的电脑是 Mac Retina 屏，AI 给的坐标是按逻辑像素算的，但截图却是物理像素。结果就是鼠标总点不到位置，歪到姥姥家去了。后来 AI 加了个缩放比例计算才解决。

4、接着是识别文章标题。一开始用的 `pytesseract`，识别中文简直灾难，连"公众号"三个字都认不出来。后来换成了 `CnOcr`，识别率瞬间上去了，就是安装包有点大。

5、最头疼的是滚动逻辑。微信文章长短不一，怎么知道到底部了？一开始是傻傻地滚动固定次数，有的文章太长滚不到底，有的太短又滚过头。最后改成每滚一下截个图，跟上一张对比，如果图片一样了就是到底了。这招挺好使。

6、为了显得像真人，我还加了个 LLM（大模型）进去。每篇文章它会先读前两屏的内容，然后根据内容生成一句评论。比如文章讲育儿的，它就评个"带娃不易"之类的；讲职场的，就评个"共勉"。比千篇一律的"已阅"强多了。

7、最后还处理了个小 Bug：看完文章关闭窗口后，微信主窗口有时候会跑后台去。折腾半天发现是快捷键 `Command+W` 的锅，加上日志排查才搞定。

## 工具介绍

这工具也没啥名字，就叫它 `auto_comment` 吧。

功能很简单：
- 自动遍历公众号列表
- 识别没看过的最新文章
- 进去假装读一会儿（滚动到底）
- 根据文章内容自动生成评论（或者用固定话术）
- 自动发送留言

目前还比较初级，只能在 Mac 上跑，Windows 我还没试过（估计得改改快捷键）。

## 一些坑和感想

这一趟下来，发现自动化这事儿看着简单，细节全是坑。

比如 OCR 识别有时候会把标点符号认错，导致程序以为是新文章又点进去了。后来我加了个逻辑，把标题里的标点符号全删了再对比，这才稳了。

还有那个公众号列表滚动，滚完之后坐标没变但内容变了，这个逻辑也调了好久。

不过看着鼠标自己在屏幕上飞来飞去，自动把活干了，那种感觉确实挺爽的。

## 后续计划

现在的评论生成有时候还是有点生硬，还得再调调提示词。

另外现在的配置全靠改代码，后面有空打算弄个简单的配置文件，让不懂代码的人也能用。

---

如果你也想解放双手，可以后台回复「自动留言」获取源码（只有 Python 脚本，需要自己配环境哈）。

有问题欢迎在评论区交流。

---

懿起成长
